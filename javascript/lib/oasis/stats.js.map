{"version":3,"file":"module.js","sources":["../src/log.ts","../src/hooks/DrawCallHook.ts","../src/hooks/ShaderHook.ts","../src/hooks/TextureHook.ts","../src/Core.ts","../src/Monitor.ts","../src/Stats.ts","../src/index.ts"],"sourcesContent":["import { Logger } from \"oasis-engine\";\n\nexport function log(...args: any) {\n  Logger.info(\"ðŸš€ [o3-engine-stats]\", ...args);\n}\n\nexport function errorLog(...args: any) {\n  Logger.error(\"ðŸš€ [o3-engine-stats]\", ...args);\n}\n","import { log, errorLog } from \"../log\";\n\n/**\n * @class DrawCallHook\n */\nexport default class DrawCallHook {\n  public drawCall: number = 0;\n  public triangles: number = 0;\n  public lines: number = 0;\n  public points: number = 0;\n  private hooked: boolean;\n  private realDrawElements: any;\n  private realDrawArrays: any;\n  private gl: WebGLRenderingContext | WebGL2RenderingContext;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.realDrawElements = gl.drawElements;\n    this.realDrawArrays = gl.drawArrays;\n\n    gl.drawElements = this.hookedDrawElements.bind(this);\n    gl.drawArrays = this.hookedDrawArrays.bind(this);\n\n    this.hooked = true;\n    this.gl = gl;\n\n    log(`DrawCall is hooked.`);\n  }\n\n  private hookedDrawElements(mode: number, count: number, type: number, offset: number) {\n    this.realDrawElements.call(this.gl, mode, count, type, offset);\n    this.update(count, mode);\n  }\n\n  private hookedDrawArrays(mode: number, first: number, count: number) {\n    this.realDrawArrays.call(this.gl, mode, first, count);\n    this.update(count, mode);\n  }\n\n  private update(count: number, mode: number) {\n    const { gl } = this;\n\n    this.drawCall++;\n\n    switch (mode) {\n      case gl.TRIANGLES:\n        this.triangles += count / 3;\n        break;\n\n      case gl.TRIANGLE_STRIP:\n      case gl.TRIANGLE_FAN:\n        this.triangles += count - 2;\n        break;\n\n      case gl.LINES:\n        this.lines += count / 2;\n        break;\n\n      case gl.LINE_STRIP:\n        this.lines += count - 1;\n        break;\n\n      case gl.LINE_LOOP:\n        this.lines += count;\n        break;\n\n      case gl.POINTS:\n        this.points += count;\n        break;\n\n      default:\n        errorLog(`Unknown draw mode: ${mode}`);\n        break;\n    }\n  }\n\n  public reset(): void {\n    this.drawCall = 0;\n    this.triangles = 0;\n    this.lines = 0;\n    this.points = 0;\n  }\n\n  public release(): void {\n    if (this.hooked) {\n      this.gl.drawElements = this.realDrawElements;\n      this.gl.drawArrays = this.realDrawArrays;\n    }\n\n    this.hooked = false;\n  }\n}\n","import { log, errorLog } from \"../log\";\n\n/**\n * @class ShaderHook\n */\nexport default class ShaderHook {\n  public shaders: number = 0;\n  private realAttachShader: any;\n  private realDetachShader: any;\n  private hooked: boolean;\n  private gl: WebGLRenderingContext | WebGL2RenderingContext;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.realAttachShader = gl.attachShader;\n    this.realDetachShader = gl.detachShader;\n\n    gl.attachShader = this.hookedAttachShader.bind(this);\n    gl.detachShader = this.hookedDetachShader.bind(this);\n\n    this.hooked = true;\n    this.gl = gl;\n\n    log(`Shader is hooked.`);\n  }\n\n  private hookedAttachShader(program: any, shader: any) {\n    this.realAttachShader.call(this.gl, program, shader);\n\n    this.shaders++;\n\n    log(`AttachShader:`, shader, `shaders: ${this.shaders}`);\n  }\n\n  private hookedDetachShader(program: any, shader: any) {\n    this.realDetachShader.call(this.gl, program, shader);\n\n    this.shaders--;\n\n    log(`DetachShader. shaders: ${this.shaders}`);\n  }\n\n  public reset() {\n    this.shaders = 0;\n  }\n\n  public release() {\n    if (this.hooked) {\n      this.gl.attachShader = this.realAttachShader;\n      this.gl.detachShader = this.realDetachShader;\n    }\n\n    this.hooked = false;\n  }\n}\n","import { log, errorLog } from \"../log\";\n\n/**\n * @class TextureHook\n */\nexport default class TextureHook {\n  public textures: number = 0;\n  private realCreateTexture: any;\n  private realDeleteTexture: any;\n  private hooked: boolean;\n  private gl: WebGLRenderingContext | WebGL2RenderingContext;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.realCreateTexture = gl.createTexture;\n    this.realDeleteTexture = gl.deleteTexture;\n\n    gl.createTexture = this.hookedCreateTexture.bind(this);\n    gl.deleteTexture = this.hookedDeleteTexture.bind(this);\n\n    this.hooked = true;\n    this.gl = gl;\n\n    log(`Texture is hooked.`);\n  }\n\n  private hookedCreateTexture() {\n    let texture = this.realCreateTexture.call(this.gl);\n\n    this.textures++;\n\n    log(`CreateTexture:`, texture, `textures: ${this.textures}`);\n\n    return texture;\n  }\n\n  private hookedDeleteTexture(texture: any) {\n    this.realDeleteTexture.call(this.gl, texture);\n\n    this.textures--;\n\n    log(`DeleteTexture. textures: ${this.textures}`);\n  }\n\n  public reset() {\n    this.textures = 0;\n  }\n\n  public release() {\n    if (this.hooked) {\n      this.gl.createTexture = this.realCreateTexture;\n      this.gl.deleteTexture = this.realDeleteTexture;\n    }\n\n    this.hooked = false;\n  }\n}\n","import { Entity } from \"oasis-engine\";\nimport DrawCallHook from \"./hooks/DrawCallHook\";\nimport ShaderHook from \"./hooks/ShaderHook\";\nimport TextureHook from \"./hooks/TextureHook\";\n\ndeclare global {\n  interface Performance {\n    memory: any;\n  }\n}\n\n/**\n * @class Core\n */\nexport default class Core {\n  private gl: WebGLRenderingContext | WebGL2RenderingContext;\n  private drawCallHook: DrawCallHook;\n  private textureHook: TextureHook;\n  private shaderHook: ShaderHook;\n  private samplingFrames: number = 60;\n  private samplingIndex: number = 0;\n  private updateCounter: number = 0;\n  private updateTime: number = 0;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.gl = gl;\n    this.hook(gl);\n  }\n\n  private hook(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.drawCallHook = new DrawCallHook(gl);\n    this.textureHook = new TextureHook(gl);\n    this.shaderHook = new ShaderHook(gl);\n  }\n\n  public reset() {\n    this.drawCallHook && this.drawCallHook.reset();\n  }\n\n  public release() {\n    this.drawCallHook && this.drawCallHook.release();\n    this.textureHook && this.textureHook.release();\n    this.shaderHook && this.shaderHook.release();\n  }\n\n  public update() {\n    this.updateCounter++;\n    let now = performance.now();\n    if (now - this.updateTime < 1000) {\n      return;\n    }\n\n    if (this.samplingIndex !== this.samplingFrames) {\n      this.reset();\n      this.samplingIndex++;\n      return;\n    }\n\n    this.samplingIndex = 0;\n\n    let data = {\n      fps: Math.round((this.updateCounter * 1000) / (now - this.updateTime)),\n      memory: performance.memory && (performance.memory.usedJSHeapSize / 1048576) >> 0,\n      drawCall: this.drawCallHook.drawCall,\n      triangles: this.drawCallHook.triangles,\n      //@ts-ignorets-ignore\n      nodes: Entity._entitys.length,\n      lines: this.drawCallHook.lines,\n      points: this.drawCallHook.points,\n      textures: this.textureHook.textures,\n      shaders: this.shaderHook.shaders,\n      webglContext:\n        window.hasOwnProperty(\"WebGL2RenderingContext\") && this.gl instanceof WebGL2RenderingContext ? \"2.0\" : \"1.0\"\n    };\n\n    this.reset();\n\n    this.updateCounter = 0;\n    this.updateTime = now;\n\n    return data;\n  }\n}\n","import Core from \"./Core\";\n\nlet tpl = `\n  <dl>\n    <dt>FPS</dt>\n    <dd>0</dd>\n    <dt>Memory <span class=\"unit\">(MB)</span></dt>\n    <dd>0</dd>\n    <dt>DrawCall</dt>\n    <dd>0</dd>\n    <dt>Triangles</dt>\n    <dd>0</dd>\n    <dt>Nodes</dt>\n    <dd>0</dd>\n    <dt>Textures</dt>\n    <dd>0</dd>\n    <dt>Shaders</dt>\n    <dd>0</dd>\n    <dt>WebGL</dt>\n    <dd></dd>\n  </dl>\n`;\nlet css = `\n  .gl-perf {\n    pointer-events: none;\n    user-select: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    padding: ${10 / 7.5}vh ${10 / 7.5}vh 0 ${10 / 7.5}vh;\n    background: rgba(0, 0, 0, 0.3);\n    color: #fff;\n    font: ${10 / 7.5}vh arial;\n  }\n\n  .gl-perf dl,\n  .gl-perf dt,\n  .gl-perf dd {\n    padding: 0;\n    margin: 0;\n  }\n\n  .gl-perf dt {\n    color: #fff;\n    text-shadow: #000 0 0 1px;\n  }\n\n  .gl-perf dt .unit{\n    font-size: ${10 / 7.5}vh;\n  }\n\n  .gl-perf dd {\n    font-size: ${20 / 7.5}vh;\n    padding: ${10 / 7.5}vh 0 ${10 / 7.5}vh;\n  }\n`;\n\nexport default class Monitor {\n  private core: Core;\n  private doms: HTMLElement[];\n  private items: string[];\n  private container: HTMLElement;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.core = new Core(gl);\n    this.items = [];\n    this.items = [\"fps\", \"memory\", \"drawCall\", \"triangles\", \"nodes\", \"textures\", \"shaders\", \"webglContext\"];\n    this.createContainer();\n    this.update = this.update.bind(this);\n  }\n\n  private createContainer() {\n    let container = document.createElement(\"div\");\n    container.classList.add(\"gl-perf\");\n    container.innerHTML = tpl;\n\n    container.appendChild(this.createStyle());\n\n    document.body.appendChild(container);\n\n    this.doms = Array.prototype.slice.apply(container.querySelectorAll(\"dd\"));\n    this.container = container;\n  }\n\n  private createStyle() {\n    let style: HTMLStyleElement = document.createElement(\"style\");\n\n    style.type = \"text/css\";\n\n    style.appendChild(document.createTextNode(css));\n\n    return style;\n  }\n\n  /**\n   * Update per frame\n   */\n  public update() {\n    let data = this.core.update();\n\n    if (data) {\n      for (let i = 0, l = this.items.length; i < l; i++) {\n        let dom = this.doms[i];\n        let item = this.items[i];\n        let value = data[item] || 0;\n\n        // see: http://wilsonpage.co.uk/preventing-layout-thrashing/\n        requestAnimationFrame(() => {\n          dom.innerText = value;\n        });\n      }\n    }\n  }\n\n  /**\n   * reset all hooks\n   */\n  public reset() {\n    this.core.reset();\n  }\n\n  /**\n   * release all hooks\n   */\n  public release() {\n    this.core.release();\n  }\n\n  /**\n   * destory the instance\n   */\n  public destroy() {\n    this.release();\n    document.body.removeChild(this.container);\n  }\n}\n","import { EngineFeature, Engine, Scene } from \"oasis-engine\";\nimport Monitor from \"./Monitor\";\n\n/**\n * Engine Feature: Display engine status data such as FPS.\n */\nexport class Stats extends EngineFeature {\n  private monitor: Monitor;\n\n  /**\n   * Constructor of Stats.\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Tick pre-callback.\n   */\n  preTick(engine: Engine, currentScene: Scene): void {\n    if (!this.monitor) {\n      const gl = currentScene.engine._hardwareRenderer.gl;\n      if (gl) {\n        this.monitor = new Monitor(gl);\n      }\n    }\n  }\n\n  /**\n   * Tick post-callback.\n   */\n  postTick(engine: Engine, currentScene: Scene): void {\n    if (this.monitor) {\n      this.monitor.update();\n    }\n  }\n}\n","import { Engine } from \"oasis-engine\";\nimport { Stats } from \"./Stats\";\n\nEngine.registerFeature(Stats);\n\nexport { Stats };\n"],"names":["log","args","Logger","info","errorLog","error","DrawCallHook","gl","drawCall","triangles","lines","points","hooked","realDrawElements","realDrawArrays","drawElements","drawArrays","hookedDrawElements","bind","hookedDrawArrays","mode","count","type","offset","call","update","first","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","LINES","LINE_STRIP","LINE_LOOP","POINTS","reset","release","ShaderHook","shaders","realAttachShader","realDetachShader","attachShader","detachShader","hookedAttachShader","hookedDetachShader","program","shader","TextureHook","textures","realCreateTexture","realDeleteTexture","createTexture","deleteTexture","hookedCreateTexture","hookedDeleteTexture","texture","Core","drawCallHook","textureHook","shaderHook","samplingFrames","samplingIndex","updateCounter","updateTime","hook","now","performance","data","fps","Math","round","memory","usedJSHeapSize","nodes","Entity","_entitys","length","webglContext","window","hasOwnProperty","WebGL2RenderingContext","tpl","css","Monitor","core","doms","items","container","createContainer","document","createElement","classList","add","innerHTML","appendChild","createStyle","body","Array","prototype","slice","apply","querySelectorAll","style","createTextNode","i","l","dom","item","value","requestAnimationFrame","innerText","destroy","removeChild","Stats","monitor","preTick","engine","currentScene","_hardwareRenderer","postTick","EngineFeature","Engine","registerFeature"],"mappings":"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"}